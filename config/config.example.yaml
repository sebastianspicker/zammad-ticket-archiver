# Example configuration for zammad-pdf-archiver.
# Copy to config/config.yaml and adjust values.
# Do not commit secrets.
#
# Precedence: ENV > YAML > defaults.

server:
  host: "0.0.0.0"              # SERVER_HOST
  port: 8080                     # SERVER_PORT
  webhook_shared_secret: null    # WEBHOOK_SHARED_SECRET (legacy fallback)

zammad:
  base_url: "https://zammad.example.local"  # ZAMMAD_BASE_URL
  api_token: "CHANGE-ME"                    # ZAMMAD_API_TOKEN
  webhook_hmac_secret: "CHANGE-ME"          # WEBHOOK_HMAC_SECRET
  timeout_seconds: 10.0                       # ZAMMAD_TIMEOUT_SECONDS
  verify_tls: true                            # ZAMMAD_VERIFY_TLS

workflow:
  trigger_tag: "pdf:sign"
  require_tag: true
  acknowledge_on_success: true
  delivery_id_ttl_seconds: 3600

fields:
  archive_path: "archive_path"
  archive_user_mode: "archive_user_mode"

storage:
  root: "/mnt/archive"   # STORAGE_ROOT
  atomic_write: true       # STORAGE_ATOMIC_WRITE
  fsync: true              # STORAGE_FSYNC
  path_policy:
    allow_prefixes:
      - "Customers/"
      - "Internal/"
    sanitize:
      replace_whitespace: "_"
      strip_control_chars: true
    filename_pattern: "Ticket-{ticket_number}_{timestamp_utc}.pdf"

pdf:
  template_variant: "default"   # default|minimal
  locale: "de_DE"
  timezone: "Europe/Berlin"
  max_articles: 250

signing:
  enabled: false                  # SIGNING_ENABLED
  pfx_path: "/run/secrets/signing.pfx"    # SIGNING_PFX_PATH
  pfx_password: null              # SIGNING_PFX_PASSWORD
  pades:
    reason: "Ticket Archivierung" # SIGNING_REASON
    location: "Datacenter"        # SIGNING_LOCATION
  timestamp:
    enabled: false                # TSA_ENABLED
    rfc3161:
      tsa_url: "https://tsa.example.local/rfc3161"  # TSA_URL
      timeout_seconds: 10.0       # TSA_TIMEOUT_SECONDS
      ca_bundle_path: null        # TSA_CA_BUNDLE_PATH

observability:
  log_level: "INFO"             # LOG_LEVEL
  log_format: null               # LOG_FORMAT (json|human)
  json_logs: false               # LOG_JSON (legacy)
  metrics_enabled: false         # METRICS_ENABLED

hardening:
  rate_limit:
    enabled: true                # RATE_LIMIT_ENABLED
    rps: 5.0                     # RATE_LIMIT_RPS
    burst: 10                    # RATE_LIMIT_BURST
    include_metrics: false       # RATE_LIMIT_INCLUDE_METRICS
  body_size_limit:
    max_bytes: 1048576           # MAX_BODY_BYTES
  webhook:
    allow_unsigned: false        # HARDENING_WEBHOOK_ALLOW_UNSIGNED
    require_delivery_id: false   # HARDENING_WEBHOOK_REQUIRE_DELIVERY_ID
  transport:
    trust_env: false             # HARDENING_TRANSPORT_TRUST_ENV
    allow_insecure_http: false   # HARDENING_TRANSPORT_ALLOW_INSECURE_HTTP
    allow_insecure_tls: false    # HARDENING_TRANSPORT_ALLOW_INSECURE_TLS
    allow_local_upstreams: false # HARDENING_TRANSPORT_ALLOW_LOCAL_UPSTREAMS
